
sessPath = '/mnt/diskArray/projects/LMB_Analysis/NLR_KB218/concatVista';
cd(sessPath)
%mrVista

roiName = {'concatFFA'};
dt = [1];
scan = [1 2 3 4 5 6 7 8];
vw = initHiddenInplane(dt,scan,roiName);

% % enforce consistent preprocessing / event-related parameters
params = er_defaultParams;
params.detrend = 2;
params.framePeriod = 2; %ek -changes detrend to quadratic
% params.onsetDelta =  0;     % we deleted 4 frames = 6 seconds in pre-processing
 params.glmHRF     =  3;
% params = er_getParams(vw);
% params.detrend = 2; % high-pass filter (low-pass is blurring, below)
% %params.inhomoCorrection = 1; % divide by mean
% %params.temporalNormalization = 0; % no matching 1st temporal fram
% params.glmHRF = 3; % flag for spm HIRF
% params.framePeriod = 2; % number of TRs
% params.ampType = 'betas';
% %params.peakPeriod=[6 8 10 12 14]; % peak period for timecourse 
% er_setParams(vw, params);
%% Apply glm separately for each session
mv(1) = mv_init(vw,1,[1 2]);
%mv(1) = mv_init(INPLANE{2},1,[1 2])
mv(2) = mv_init(vw,1,[3 4]);
mv(3) = mv_init(vw,1,[5 6]);
mv(4) = mv_init(vw,1,[7 8]);

for ii = 1:length(mv)
    tempmv(ii) = mv_applyGlm(mv(ii));
    % average teh betas across voxels
    b(ii,:) = mean(tempmv(ii).glm.betas,3);
end
figure
bar(b)